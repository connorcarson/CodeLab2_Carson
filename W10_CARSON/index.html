<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.19.0/phaser.js"></script>
</head>
<body>

    <script>
        var game = new Phaser.Game({
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            backgroundColor: '#272829',
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        });

        function preload ()
        {
           this.load.spritesheet('sm', 'assets/sprites/sm-special-move.png', { frameWidth: 75, frameHeight: 125 });
        }

        var sm;
        var anim;
        var nextFrame;
        let buffer;
        let currentGoal;
        let currentGoalIndex;

        function create ()
        {
            //frameView = this.add.graphics({ fillStyle: { color: 0xff00ff }, x: 32, y: 32 });

            sm = this.add.sprite(400, 300, 'sm').setScale(2, 2);

            nextFrame = 1;

            //is this a prototype?
            var config = {
                key: 'special-move',
                frames: this.anims.generateFrameNumbers('sm', {start: 0, end: 35, first: 0}),
                frameRate: 20,
                yoyo: false,
                repeat: 0
            };

            anim = this.anims.create(config);

            var powers =
                    ["moooooooooon tiaaaaraaaaaaaa magic",
                    "mooooooon heeeeaaaaling activation",
                    "cooooosmiiiiic mooooooooooon power",
                    "moooooooooon crystaaaaaaaaal power",
                    "mooooooon scepterrrrrr elimination",
                    "moooooon spiiiralll hearrrt attack",
                    "mooooooon gorgeoussssss meditation"]

            currentGoal = powers[0].split("");

            var goalText = this.add.text(0, 0, powers[0], { font: "35px Arial", fill: "#ff0044", boundsAlignH: "center", boundsAlignV: "middle" });
            goalText.setPosition(400 - goalText.width/2, 450);

            //sm.anims.play('special-move');

            buffer = [];
            let lastKeyTime = Date.now();

            document.addEventListener('keydown', event => {
                const charList = 'abcdefghijklmnopqrstuvwxyz0123456789 ';
                const key = event.key.toLowerCase();

                // we are only interested in alphanumeric keys
                if (charList.indexOf(key) === -1) return;

                const currentTime = Date.now();
                //1000 is milliseconds here, so 1 full second
                if(currentTime - lastKeyTime > 1000){
                    buffer = [];
                    nextFrame = 1;
                    sm.setFrame(0);
                }

                lastKeyTime = currentTime;

                buffer.push(key);

                if(buffer[buffer.length - 1] === currentGoal[buffer.length -1]){
                    console.log("You wrote the next correct character!")
                    nextFrame += 1;
                    sm.setFrame(nextFrame);
                }
                if(arraysMatch(buffer, currentGoal)){
                    console.log("You wrote the correct string!")
                    sm.anims.play('special-move');
                }
            });

        }


        function update ()
        {
            if(nextFrame >= 35) {nextFrame = 1;}
        }

        var arraysMatch = function (arr1, arr2) {

            // Check if the arrays are the same length
            if (arr1.length !== arr2.length) return false;
            // Check if all items exist and are in the same order
            for (var i = 0; i < arr1.length; i++) {
                if (arr1[i] !== arr2[i]) return false;
            }
            // Otherwise, return true
            return true;
        };

    </script>

</body>
</html>